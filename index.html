<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow States | flowstates.me</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Noto+Serif+SC:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; overflow-x: hidden; }
        .font-serif-en { font-family: 'Lora', serif; }
        .font-serif-cn { font-family: 'Noto Serif SC', serif; }
        #flowCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; }
        .fade-in { animation: fadeIn 1.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="antialiased selection:bg-teal-500 selection:text-white">

    <canvas id="flowCanvas"></canvas>

    <nav class="fixed top-0 w-full p-6 flex justify-between items-center z-50 backdrop-blur-sm bg-slate-900/30">
        <div class="text-xl font-bold tracking-widest opacity-90 hover:text-teal-300 transition cursor-pointer" onclick="window.location.reload()">
            flowstates.me
        </div>
        <button id="langToggle" class="px-4 py-1 border border-slate-500 rounded-full text-xs hover:bg-teal-900/50 hover:border-teal-400 transition uppercase tracking-wide">
            Switch to 中文
        </button>
    </nav>

    <main class="min-h-screen flex flex-col justify-center items-center px-4 sm:px-0 py-20 relative z-10">
        <article class="max-w-2xl w-full fade-in mb-20">
            <h1 class="text-5xl sm:text-6xl font-bold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-teal-200 to-blue-200">
                <span class="content-en font-serif-en">Flow States</span>
                <span class="content-zh hidden font-serif-cn">心流时刻</span>
            </h1>
            <div class="text-center space-y-6 text-lg sm:text-xl opacity-80 font-light max-w-lg mx-auto">
                <p class="content-en font-serif-en">A digital garden dedicated to capturing the fleeting moments of absolute clarity and creation.</p>
                <p class="content-zh hidden font-serif-cn">一座数字花园，致力于捕捉那些绝对清醒与创造力的稍纵即逝的时刻。</p>
            </div>
        </article>

        <!-- 动态博客列表区域 -->
        <section id="blog-section" class="max-w-2xl w-full fade-in border-t border-slate-800 pt-10">
            <h2 class="text-xs uppercase tracking-[0.2em] text-teal-500 mb-8 text-center">
                <span class="content-en">Flow Logs</span>
                <span class="content-zh hidden">心流日志</span>
            </h2>
            <div id="post-list" class="space-y-6">
                <div class="text-center opacity-50 text-sm italic">Connecting to GitHub...</div>
            </div>
        </section>
    </main>

    <footer class="fixed bottom-6 w-full text-center opacity-40 text-xs uppercase tracking-widest pointer-events-none">
        22abad @ Ireland
    </footer>

    <script>
    (function() {
        // 配置：你的 GitHub 用户名和仓库名
        const GITHUB_USERNAME = '22abad'; 
        const GITHUB_REPO = 'flowstates-website'; // 确保这和你的仓库名一致
        const POSTS_FOLDER = 'posts'; // 存放 .md 文件的文件夹名

        // 1. 语言切换逻辑
        const toggleBtn = document.getElementById('langToggle');
        let isEnglish = true;

        function updateLang() {
            const enEls = document.querySelectorAll('.content-en');
            const zhEls = document.querySelectorAll('.content-zh');
            if (isEnglish) {
                zhEls.forEach(el => el.classList.add('hidden'));
                enEls.forEach(el => el.classList.remove('hidden'));
                toggleBtn.textContent = 'Switch to 中文';
            } else {
                enEls.forEach(el => el.classList.add('hidden'));
                zhEls.forEach(el => el.classList.remove('hidden'));
                toggleBtn.textContent = 'Switch to English';
            }
        }

        toggleBtn.addEventListener('click', () => {
            isEnglish = !isEnglish;
            updateLang();
        });

        // 2. 动态获取 GitHub 文件列表并解析 Front Matter
        async function loadPosts() {
            const listContainer = document.getElementById('post-list');
            try {
                // 调用 GitHub API 获取文件列表
                const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${POSTS_FOLDER}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) throw new Error('GitHub API limit or Network error');
                
                const files = await response.json();
                
                // 过滤出 .md 文件
                const mdFiles = files.filter(file => file.name.endsWith('.md'));

                if (mdFiles.length === 0) {
                    listContainer.innerHTML = '<div class="text-center opacity-50">No logs found yet.</div>';
                    return;
                }

                listContainer.innerHTML = ''; // 清空 Loading 提示

                // 遍历每个文件，获取内容并提取元数据
                // 注意：为了性能，这里并发请求所有文章的内容（GitHub API 有速率限制，文章多了可能需要优化）
                const postsData = await Promise.all(mdFiles.map(async (file) => {
                    // 获取 raw 内容
                    const contentRes = await fetch(file.download_url);
                    const text = await contentRes.text();
                    
                    // 简单的 Front Matter 解析器 (提取文件头部的 JSON 配置)
                    // 格式要求：文章开头必须是 ```json ... ``` 包含的元数据
                    const match = text.match(/^```json\s*([\s\S]*?)\s*```/);
                    let meta = { 
                        title_en: file.name.replace('.md', ''), 
                        title_zh: file.name.replace('.md', ''),
                        date: 'Unknown',
                        summary_en: 'No summary.',
                        summary_zh: '暂无简介。'
                    };

                    if (match) {
                        try {
                            meta = JSON.parse(match[1]);
                        } catch (e) { console.warn('Failed to parse meta for', file.name); }
                    }
                    
                    return { ...meta, filename: file.name };
                }));

                // 按日期倒序排列 (新的在前)
                postsData.sort((a, b) => new Date(b.date) - new Date(a.date));

                // 渲染列表
                postsData.forEach(post => {
                    const item = document.createElement('a');
                    item.href = `post.html?id=${post.filename.replace('.md', '')}`; // 链接到通用阅读器
                    item.className = "block group p-6 rounded-lg hover:bg-slate-800/50 transition border border-transparent hover:border-slate-700";
                    item.innerHTML = `
                        <div class="flex justify-between items-baseline mb-2">
                            <h3 class="text-xl font-serif-en group-hover:text-teal-300 transition">
                                <span class="content-en">${post.title_en}</span>
                                <span class="content-zh hidden">${post.title_zh}</span>
                            </h3>
                            <span class="text-xs font-mono opacity-50 whitespace-nowrap ml-4">${post.date}</span>
                        </div>
                        <p class="text-sm opacity-60 font-light leading-relaxed">
                            <span class="content-en">${post.summary_en}</span>
                            <span class="content-zh hidden">${post.summary_zh}</span>
                        </p>
                    `;
                    listContainer.appendChild(item);
                });

                updateLang(); // 刷新语言显示

            } catch (error) {
                console.error(error);
                listContainer.innerHTML = `<div class="text-center text-red-400 text-sm">Failed to load from GitHub.<br><span class="text-xs opacity-50">${error.message}</span></div>`;
            }
        }

        // 3. Canvas 动画 (保持不变)
        const canvas = document.getElementById('flowCanvas');
        const ctx = canvas.getContext('2d');
        let w, h, particles = [];
        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
        function anim() {
            ctx.clearRect(0, 0, w, h);
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if(p.x < 0) p.x = w; if(p.x > w) p.x = 0;
                if(p.y < 0) p.y = h; if(p.y > h) p.y = 0;
                ctx.fillStyle = 'rgba(94, 234, 212, 0.15)';
                ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(anim);
        }
        window.addEventListener('resize', resize); resize();
        for(let i=0; i<40; i++) particles.push({x:Math.random()*w, y:Math.random()*h, vx:(Math.random()-0.5)*0.2, vy:(Math.random()-0.5)*0.2, s:Math.random()*2});
        anim();

        // 初始化
        loadPosts();
    })();
    </script>
</body>
</html>